"use strict";var TetrisPlus={config:{parentId:"game",backgroundColour:"#DDDDDD",emptyBlockColour:"#FFFFFF",overlayColour:"#000000",overlayTextColour:"#FFFFFF",scoreTextColour:"#000000",borderColour:"#000000",blockSizeRelative:10,gapSizeRelative:.5,boardWidth:10,boardHeight:20,moveDownDelay:80,targetFrameRate:60,dropSpeeds:[800,720,630,550,470,380,300,220,130,100,80],linesPerLevel:5,useDarkTheme:!1,useBackgroundGrid:!1,pieceColours:{I:"#f7d308",O:"#47e6ff",J:"#5a65ad",L:"#ef7921",S:"#42b642",Z:"#ef2029",T:"#ad4d9c"}},darkTheme:{backgroundColour:"#000000",emptyBlockColour:"#4c5a61",overlayColour:"#000000",overlayTextColour:"#FFFFFF",scoreTextColour:"#FFFFFF",borderColour:"#FFFFFF"},Coord2d:class{constructor(e,s){this.x=e,this.y=s}clone(){return new TetrisPlus.Coord2d(this.x,this.y)}},Input:{}};TetrisPlus.Input.Key={LEFT:37,UP:38,RIGHT:39,DOWN:40,ESCAPE:27,SPACE:32,P:80,R:82,pressed:{},down:{},up:{},getKey:function(e){return this.pressed[e]},getKeyDown:function(e){return this.down[e]},getKeyUp:function(e){return this.up[e]},clear:function(){this.down={},this.up={}},onKeydown:function(e){1!=this.pressed[e.keyCode]&&(this.down[e.keyCode]=!0),this.pressed[e.keyCode]=!0},onKeyup:function(e){1==this.pressed[e.keyCode]&&(this.up[e.keyCode]=!0),delete this.pressed[e.keyCode]}},TetrisPlus.Helper={},TetrisPlus.Helper.throttle=function(e,s,r){var t,o,i,n=null,l=0;r||(r={});var a=function(){l=!1===r.leading?0:Date.now(),n=null,i=e.apply(t,o),n||(t=o=null)};return function(){var u=Date.now();l||!1!==r.leading||(l=u);var d=s-(u-l);return t=this,o=arguments,d<=0||d>s?(n&&(clearTimeout(n),n=null),l=u,i=e.apply(t,o),n||(t=o=null)):n||!1===r.trailing||(n=setTimeout(a,d)),i}},TetrisPlus.Helper.extend=function(e,s){for(var r in s)s.hasOwnProperty(r)&&(e[r]=s[r]);return e},TetrisPlus.makeRandomBag=function(){var e={};return function(){var e,s=["I","O","J","L","S","Z","T"];this.getNextLetter=function(){return 0==e.length&&this.reshuffle(),e.pop()},this.reshuffle=function(){var r;e=Array.from(s);for(var t=0,o=0;o<s.length;o++)t=Math.floor(7*Math.random()),r=e[t],e[t]=e[o],e[o]=r},this.printContents=function(){for(var s="piecesInBag.length = "+e.length,r=0;r<e.length;r++)s+=TetrisPlus.Pieces.printPiece(e[r]);return s},this.reshuffle()}.apply(e),e},TetrisPlus.board={canvas:{},canvasHeightRelative:0,canvasWidthRelative:0,canvasScaleMultiplier:1,overlayMessages:[],blockSize:0,gapSize:0,makeBlock:function(e,s,r){var t={};return function(){var t=e,o=s,i=r;this.setColour=function(e){i=e},this.getColour=function(){return i},this.setXcoord=function(e){t=e},this.setYcoord=function(e){o=e},this.draw=function(){TetrisPlus.board.canvas.ctx.fillStyle=i,TetrisPlus.board.canvas.ctx.fillRect(t,o,this.blockSize,this.blockSize)}}.apply(t),t},calculateCanvasDimensions:function(){this.canvas.element.height=this.canvas.parent.offsetHeight,this.canvasScaleMultiplier=this.canvas.element.height/this.canvasHeightRelative,this.blockSize=TetrisPlus.config.blockSizeRelative*this.canvasScaleMultiplier,this.gapSize=TetrisPlus.config.gapSizeRelative*this.canvasScaleMultiplier,this.canvas.element.height=this.blockSize*TetrisPlus.config.boardHeight+this.gapSize*(TetrisPlus.config.boardHeight+1),this.canvas.element.width=this.blockSize*TetrisPlus.config.boardWidth+this.gapSize*(TetrisPlus.config.boardWidth+1)},createBoard:function(){this.calculateCanvasDimensions(),this.setupBoardArrays()},drawBoard:function(){this.canvas.ctx.fillStyle=TetrisPlus.config.backgroundColour,this.canvas.ctx.fillRect(0,0,this.canvas.element.width,this.canvas.element.height);for(var e=0,s=0,r=0;r<TetrisPlus.config.boardWidth;r++)for(var t=0;t<TetrisPlus.config.boardHeight;t++)e=(this.blockSize+this.gapSize)*r+this.gapSize,s=(this.blockSize+this.gapSize)*(TetrisPlus.config.boardHeight-1)-t*(this.blockSize+this.gapSize)+this.gapSize,this.canvas.ctx.fillStyle=this.blocks[r][t].getColour(),this.canvas.ctx.fillRect(e,s,this.blockSize,this.blockSize),this.blocks[r][t].setXcoord(e),this.blocks[r][t].setYcoord(s)},setupBoardArrays:function(){this.blocks=[],this.collisionMap=[];for(var e=0;e<TetrisPlus.config.boardWidth;e++){this.collisionMap.push([]),this.blocks.push([]);for(var s=0;s<TetrisPlus.config.boardHeight;s++)this.collisionMap[e].push(!1),this.blocks[e].push(TetrisPlus.board.makeBlock(e,s,TetrisPlus.config.emptyBlockColour))}},showBoard:function(){this.canvas.element.style.display="block"},spawnPiece:function(e){TetrisPlus.board.currentPiece.setupPiece(e),this.checkCollisionForPiecePosition(TetrisPlus.board.currentPiece.getSpawnCoords())?this.updatePieceOnBoard():TetrisPlus.Game.gameOver()},setPieceInPlace:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++)this.collisionMap[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y]=!0;this.checkCompletedLines(),this.spawnPiece(TetrisPlus.Game.randomBag.getNextLetter())},movePieceDown:function(){return this.checkCollisionDown()?(this.clearPieceFromBoard(),TetrisPlus.board.currentPiece.moveDown(),this.updatePieceOnBoard(),TetrisPlus.Game.resetTickTimer(),!0):(this.setPieceInPlace(),!1)},userMoveDown:TetrisPlus.Helper.throttle(function(){TetrisPlus.board.movePieceDown()},TetrisPlus.config.moveDownDelay),movePieceLeft:function(){this.checkCollisionLeft()&&(this.clearPieceFromBoard(),TetrisPlus.board.currentPiece.moveLeft(),this.updatePieceOnBoard())},movePieceRight:function(){this.checkCollisionRight()&&(this.clearPieceFromBoard(),TetrisPlus.board.currentPiece.moveRight(),this.updatePieceOnBoard())},rotatePiece:function(){TetrisPlus.board.currentPiece.rotate()},clearBoard:function(){for(var e=0;e<TetrisPlus.config.boardWidth;e++)for(var s=0;s<TetrisPlus.config.boardHeight;s++)this.blocks[e][s].setColour(TetrisPlus.config.emptyBlockColour),this.collisionMap[e][s]=!1},clearPieceFromBoard:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++)this.blocks[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y].setColour(TetrisPlus.config.emptyBlockColour)},updatePieceOnBoard:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++)this.blocks[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y].setColour(TetrisPlus.board.currentPiece.getColour())},drawPiece:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++)this.blocks[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y].draw()},checkCollisionDown:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++){if(0==TetrisPlus.board.currentPiece.getCurrentCoords()[e].y)return!1;if(this.collisionMap[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y-1])return!1}return!0},checkCollisionLeft:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++){if(0==TetrisPlus.board.currentPiece.getCurrentCoords()[e].x)return!1;if(this.collisionMap[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x-1][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y])return!1}return!0},checkCollisionRight:function(){for(var e=0;e<TetrisPlus.board.currentPiece.getCurrentCoords().length;e++){if(TetrisPlus.board.currentPiece.getCurrentCoords()[e].x==TetrisPlus.config.boardWidth-1)return!1;if(this.collisionMap[TetrisPlus.board.currentPiece.getCurrentCoords()[e].x+1][TetrisPlus.board.currentPiece.getCurrentCoords()[e].y])return!1}return!0},checkCollisionForPiecePosition:function(e){for(var s=0;s<e.length;s++){if(e[s].x<0||e[s].x>TetrisPlus.config.boardWidth-1)return!1;if(e[s].y<0||e[s].y>TetrisPlus.config.boardHeight-1)return!1;if(this.collisionMap[e[s].x][e[s].y])return!1}return!0},checkCompletedLines:function(){for(var e=0;e<TetrisPlus.config.boardHeight;e++){for(var s=0,r=0;r<TetrisPlus.config.boardWidth;r++)1==this.collisionMap[r][e]&&s++;s>=TetrisPlus.config.boardWidth&&(this.clearLine(e),this.moveLinesDown(e),e--)}},clearLine:function(e){for(var s=0;s<TetrisPlus.config.boardWidth;s++)this.blocks[s][e].setColour(TetrisPlus.config.emptyBlockColour),this.collisionMap[s][e]=!1;TetrisPlus.Game.linesCleared++,TetrisPlus.Game.currentLevel=Math.floor(TetrisPlus.Game.linesCleared/TetrisPlus.config.linesPerLevel),TetrisPlus.Game.resetTickTimer()},moveLinesDown:function(e){for(var s=e+1;s<TetrisPlus.config.boardHeight;s++)for(var r=0;r<TetrisPlus.config.boardWidth;r++)1==this.collisionMap[r][s]&&(this.blocks[r][s-1].setColour(this.blocks[r][s].getColour()),this.blocks[r][s].setColour(TetrisPlus.config.emptyBlockColour),this.collisionMap[r][s]=!1,this.collisionMap[r][s-1]=!0)},resize:TetrisPlus.Helper.throttle(function(){TetrisPlus.board.calculateCanvasDimensions(),TetrisPlus.Game.drawGraphics(),console.log("canvas resize triggered")},500),drawScore:function(){var e=8;e*=this.canvasScaleMultiplier,this.canvas.ctx.font=e+"px Arial",this.canvas.ctx.fillStyle=TetrisPlus.config.scoreTextColour,this.canvas.ctx.globalAlpha=.7,this.canvas.ctx.fillText("Lines Cleared: "+TetrisPlus.Game.linesCleared,2*this.canvasScaleMultiplier,e),this.canvas.ctx.globalAlpha=1},toggleOverlayBackground:function(){overlayOn?(overlayOn=!1,drawBoard()):(drawOverlay(),overlayOn=!0)},drawPauseState:function(){this.drawOverlay(),this.overlayTextCentre("Paused",30),this.overlayText("Press 'R'",14,25,130),this.overlayText("To Restart",14,20,145)},drawOverlay:function(){this.canvas.ctx.fillStyle=TetrisPlus.config.overlayColour,this.canvas.ctx.globalAlpha=.5,this.canvas.ctx.fillRect(0,0,this.canvas.element.width,this.canvas.element.height),this.canvas.ctx.globalAlpha=1},overlayTextCentre:function(e,s){s*=TetrisPlus.board.canvasScaleMultiplier,this.canvas.ctx.font=s+"px Arial",this.canvas.ctx.fillStyle=TetrisPlus.config.overlayTextColour,this.canvas.ctx.fillText(e,0,this.canvas.element.height/2)},drawOverlayMessages:function(){this.drawOverlay();for(var e=0;e<this.overlayMessages.length;e++)this.overlayText(this.overlayMessages[e].message,this.overlayMessages[e].size,this.overlayMessages[e].x,this.overlayMessages[e].y)},overlayText:function(e,s,r,t){s*=TetrisPlus.board.canvasScaleMultiplier,this.canvas.ctx.font=s+"px Arial",this.canvas.ctx.fillStyle=TetrisPlus.config.overlayTextColour,this.canvas.ctx.fillText(e,r*TetrisPlus.board.canvasScaleMultiplier,t*TetrisPlus.board.canvasScaleMultiplier)}},TetrisPlus.Pieces={I:{spawnCoords:[new TetrisPlus.Coord2d(3,18),new TetrisPlus.Coord2d(4,18),new TetrisPlus.Coord2d(5,18),new TetrisPlus.Coord2d(6,18)],rotations:[[new TetrisPlus.Coord2d(-2,0),new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(0,2),new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(0,-1)]],colour:"#f7d308"},O:{spawnCoords:[new TetrisPlus.Coord2d(4,19),new TetrisPlus.Coord2d(5,19),new TetrisPlus.Coord2d(4,18),new TetrisPlus.Coord2d(5,18)],rotations:[[new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(1,1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(0,1)]],colour:"#47e6ff"},J:{spawnCoords:[new TetrisPlus.Coord2d(3,19),new TetrisPlus.Coord2d(3,18),new TetrisPlus.Coord2d(4,18),new TetrisPlus.Coord2d(5,18)],rotations:[[new TetrisPlus.Coord2d(-1,1),new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,1)],[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,-1)],[new TetrisPlus.Coord2d(-1,-1),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(0,1)]],colour:"#5a65ad"},L:{spawnCoords:[new TetrisPlus.Coord2d(5,19),new TetrisPlus.Coord2d(3,18),new TetrisPlus.Coord2d(4,18),new TetrisPlus.Coord2d(5,18)],rotations:[[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,1)],[new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,-1)],[new TetrisPlus.Coord2d(-1,-1),new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(-1,1),new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(0,-1)]],colour:"#ef7921"},S:{spawnCoords:[new TetrisPlus.Coord2d(3,18),new TetrisPlus.Coord2d(5,19),new TetrisPlus.Coord2d(4,19),new TetrisPlus.Coord2d(4,18)],rotations:[[new TetrisPlus.Coord2d(-1,-1),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,-1)],[new TetrisPlus.Coord2d(-1,-1),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,-1)]],colour:"#42b642"},Z:{spawnCoords:[new TetrisPlus.Coord2d(3,19),new TetrisPlus.Coord2d(4,18),new TetrisPlus.Coord2d(4,19),new TetrisPlus.Coord2d(5,18)],rotations:[[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,-1)],[new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,1)],[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,-1)],[new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,1)]],colour:"#ef2029"},T:{spawnCoords:[new TetrisPlus.Coord2d(4,19),new TetrisPlus.Coord2d(3,18),new TetrisPlus.Coord2d(4,18),new TetrisPlus.Coord2d(5,18)],rotations:[[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(1,0),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(0,-1)],[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,-1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(1,0)],[new TetrisPlus.Coord2d(-1,0),new TetrisPlus.Coord2d(0,1),new TetrisPlus.Coord2d(0,0),new TetrisPlus.Coord2d(0,-1)]],colour:"#ad4d9c"},printPiece:function(e){for(var s="<table>",r={I:this.I,O:this.O,J:this.J,L:this.L,S:this.S,Z:this.Z,T:this.T}[e],t=1;t>=0;t--){s+="<tr>";for(var o=0;o<4;o++){for(var i=!1,n=0;n<r.spawnCoords.length;n++)if(o==r.spawnCoords[n].x-3&&t==r.spawnCoords[n].y-18){i=!0;break}s+=1==i?'<td style="background-color: '+r.colour+'"></td>':'<td style="background-color: white"></td>'}s+="</tr>"}return s+="</table>"}},TetrisPlus.board.currentPiece=function(){var e=e,s=Array.from(TetrisPlus.Pieces.Z.spawnCoords),r=Array.from(s),t=Array.from(TetrisPlus.Pieces.Z.rotations),o=0,i=TetrisPlus.Pieces.Z.colour;return{setupPiece:function(n){switch(o=0,e=n){case"I":s=Array.from(TetrisPlus.Pieces.I.spawnCoords),t=Array.from(TetrisPlus.Pieces.I.rotations),i=TetrisPlus.Pieces.I.colour;break;case"O":s=Array.from(TetrisPlus.Pieces.O.spawnCoords),t=Array.from(TetrisPlus.Pieces.O.rotations),i=TetrisPlus.Pieces.O.colour;break;case"J":s=Array.from(TetrisPlus.Pieces.J.spawnCoords),t=Array.from(TetrisPlus.Pieces.J.rotations),i=TetrisPlus.Pieces.J.colour;break;case"L":s=Array.from(TetrisPlus.Pieces.L.spawnCoords),t=Array.from(TetrisPlus.Pieces.L.rotations),i=TetrisPlus.Pieces.L.colour;break;case"S":s=Array.from(TetrisPlus.Pieces.S.spawnCoords),t=Array.from(TetrisPlus.Pieces.S.rotations),i=TetrisPlus.Pieces.S.colour;break;case"T":s=Array.from(TetrisPlus.Pieces.T.spawnCoords),t=Array.from(TetrisPlus.Pieces.T.rotations),i=TetrisPlus.Pieces.T.colour;break;default:s=Array.from(TetrisPlus.Pieces.Z.spawnCoords),t=Array.from(TetrisPlus.Pieces.Z.rotations),i=TetrisPlus.Pieces.Z.colour}r=this.copyCoords(s)},toString:function(){return"Piece"+e},getColour:function(){return i},getSpawnCoords:function(){return s},getCurrentCoords:function(){return r},rotate:function(){TetrisPlus.board.clearPieceFromBoard();var e=o;++e>=t.length&&(e=0);for(var s=this.copyCoords(r),i=new TetrisPlus.Coord2d(r[2].x,r[2].y),n=0;n<t[e].length;n++)r[n].x=i.x+t[e][n].x,r[n].y=i.y+t[e][n].y;TetrisPlus.board.checkCollisionForPiecePosition(r)?o=e:r=s,TetrisPlus.board.updatePieceOnBoard()},moveDown:function(){for(var e=0;e<r.length;e++)r[e].y--},moveLeft:function(){for(var e=0;e<r.length;e++)r[e].x--},moveRight:function(){for(var e=0;e<r.length;e++)r[e].x++},copyCoords:function(e){for(var s=[],r=0;r<e.length;r++)s.push(new TetrisPlus.Coord2d(e[r].x,e[r].y));return s}}}(),TetrisPlus.Game={instance:null,tickTimer:800,gameTime:0,isPaused:!1,linesCleared:0,randomBag:void 0,currentLevel:0,start:function(){TetrisPlus.board.overlayMessages=[],this.linesCleared=0,this.currentLevel=0,this.tickTimer=TetrisPlus.config.dropSpeeds[this.currentLevel],TetrisPlus.board.setupBoardArrays(),window.removeEventListener("keydown",TetrisPlus.startInput),this.randomBag.reshuffle(),TetrisPlus.board.spawnPiece(this.randomBag.getNextLetter()),window.addEventListener("keyup",function(e){TetrisPlus.Input.Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){TetrisPlus.Input.Key.onKeydown(e)},!1),this.instance=setInterval(this.update,1e3/TetrisPlus.config.targetFrameRate)},startScreen:function(){TetrisPlus.board.overlayMessages.push({message:"Press Space",size:15,x:10,y:90}),TetrisPlus.board.overlayMessages.push({message:"To Start",size:15,x:25,y:110}),TetrisPlus.board.overlayMessages.push({message:"Up Arrow: Rotate",size:7,x:24,y:130}),TetrisPlus.board.overlayMessages.push({message:"Left Arrow: Move Left",size:7,x:18,y:140}),TetrisPlus.board.overlayMessages.push({message:"Right Arrow: Move Right",size:7,x:14,y:150}),TetrisPlus.board.overlayMessages.push({message:"Down Arrow: Move Down",size:7,x:13,y:160}),this.drawGraphics()},update:function(){var e=TetrisPlus.Game.lastUpdateTime();TetrisPlus.Game.isPaused||(TetrisPlus.Input.Key.getKeyDown(TetrisPlus.Input.Key.UP)&&TetrisPlus.board.rotatePiece(),TetrisPlus.Input.Key.getKeyDown(TetrisPlus.Input.Key.LEFT)&&TetrisPlus.board.movePieceLeft(),TetrisPlus.Input.Key.getKey(TetrisPlus.Input.Key.DOWN)&&TetrisPlus.board.userMoveDown(),TetrisPlus.Input.Key.getKeyDown(TetrisPlus.Input.Key.RIGHT)&&TetrisPlus.board.movePieceRight()),TetrisPlus.Input.Key.getKeyDown(TetrisPlus.Input.Key.ESCAPE)&&TetrisPlus.Game.togglePause(),TetrisPlus.Input.Key.clear(),TetrisPlus.Game.drawGraphics(),TetrisPlus.Game.isPaused||TetrisPlus.Game.decreaseTickTimer(e),TetrisPlus.Game.FrameCounter.increaseCounter(e)},drawGraphics:function(){TetrisPlus.board.drawBoard(),TetrisPlus.board.drawPiece(),TetrisPlus.board.drawScore(),this.isPaused&&TetrisPlus.board.drawPauseState(),TetrisPlus.board.overlayMessages.length>0&&TetrisPlus.board.drawOverlayMessages()},FrameCounter:function(){var e=0,s=0,r=0;return{getFrameRate:function(){return s},increaseCounter:function(s){e++,(r+=Date.now()-s)>500&&(this.updateFrameRate(2),r=0)},updateFrameRate:function(r){s=e*r,e=0}}}(),lastUpdateTime:function(){var e=Date.now();return function(){var s=e;return e=Date.now(),s}}(),resetTickTimer:function(){this.tickTimer=TetrisPlus.config.dropSpeeds[this.currentLevel]},decreaseTickTimer:function(e){this.tickTimer-=Date.now()-e,this.tickTimer<=0&&(TetrisPlus.board.movePieceDown(),this.resetTickTimer())},stop:function(){clearInterval(this.instance)},gameOver:function(){TetrisPlus.board.overlayMessages.push({message:"Game Over",size:19,x:0,y:100}),TetrisPlus.board.overlayMessages.push({message:"Press Space",size:15,x:10,y:130}),TetrisPlus.board.overlayMessages.push({message:"to Play Again",size:14,x:9,y:150}),this.drawGraphics(),this.stop(),window.addEventListener("keydown",TetrisPlus.startInput,!1)},togglePause:function(){this.isPaused?(this.isPaused=!1,clearInterval(this.instance),this.instance=setInterval(this.update,1e3/TetrisPlus.config.targetFrameRate)):(this.isPaused=!0,null!=this.instance&&(clearInterval(this.instance),window.addEventListener("keydown",TetrisPlus.startInput,!1)))}},TetrisPlus.startInput=function(e){TetrisPlus.Game.isPaused?(e.keyCode==TetrisPlus.Input.Key.ESCAPE&&(window.removeEventListener("keydown",TetrisPlus.startInput),TetrisPlus.Input.Key.clear(),TetrisPlus.Game.togglePause()),e.keyCode==TetrisPlus.Input.Key.R&&(window.removeEventListener("keydown",TetrisPlus.startInput),TetrisPlus.Input.Key.clear(),TetrisPlus.Game.togglePause(),TetrisPlus.Game.stop(),TetrisPlus.Game.start())):e.keyCode==TetrisPlus.Input.Key.SPACE&&TetrisPlus.Game.start()},TetrisPlus.init=function(e){TetrisPlus.Helper.extend(this.config,e),TetrisPlus.config.useDarkTheme&&TetrisPlus.Helper.extend(this.config,TetrisPlus.darkTheme),TetrisPlus.config.useBackgroundGrid||(TetrisPlus.config.backgroundColour=TetrisPlus.config.emptyBlockColour);for(var s=Object.keys(TetrisPlus.config.pieceColours),r=0;r<s.length;r++)TetrisPlus.Pieces[s[r]].colour=TetrisPlus.config.pieceColours[s[r]];TetrisPlus.board.canvasHeightRelative=TetrisPlus.config.blockSizeRelative*TetrisPlus.config.boardHeight+TetrisPlus.config.gapSizeRelative*(TetrisPlus.config.boardHeight+1),TetrisPlus.board.canvasWidthRelative=TetrisPlus.config.blockSizeRelative*TetrisPlus.config.boardWidth+TetrisPlus.config.gapSizeRelative*(TetrisPlus.config.boardWidth+1),TetrisPlus.board.canvas.parent=document.getElementById(TetrisPlus.config.parentId),TetrisPlus.board.canvas.element=document.createElement("canvas"),TetrisPlus.board.canvas.parent.appendChild(TetrisPlus.board.canvas.element),TetrisPlus.board.canvas.element.style.margin="0 auto",TetrisPlus.board.canvas.element.style.border="2px solid "+TetrisPlus.config.borderColour,TetrisPlus.board.canvas.ctx=TetrisPlus.board.canvas.element.getContext("2d"),TetrisPlus.board.createBoard(),TetrisPlus.Game.randomBag=TetrisPlus.makeRandomBag(),TetrisPlus.board.showBoard(),TetrisPlus.Game.startScreen(),window.addEventListener("resize",TetrisPlus.board.resize),window.addEventListener("keydown",TetrisPlus.startInput,!1)};